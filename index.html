<!DOCTYPE html>
<html lang="en" data-theme="neon-yellow">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FLAVRZ - Admin Edition</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <style>
        :root {
            --primary: #E2FF00;
            --secondary: #00E676;
            --danger: #FF3B30;
            --bg-body: #050505;
            --bg-card: #121212;
            --bg-glass: rgba(18, 18, 18, 0.98);
            --text-main: #ffffff;
            --border-color: #333333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-body); color: var(--text-main); padding-bottom: 100px; }

        /* --- TOAST NOTIFICATION --- */
        #toast-box {
            visibility: hidden; min-width: 250px; background-color: #111; color: var(--primary);
            text-align: center; border-radius: 50px; padding: 12px 20px; position: fixed; z-index: 4000;
            left: 50%; bottom: 90px; transform: translateX(-50%); font-size: 14px; border: 1px solid var(--primary);
            font-weight: 700; opacity: 0; transition: all 0.3s;
        }
        #toast-box.show { visibility: visible; opacity: 1; bottom: 110px; }

        /* --- HEADER --- */
        .brand-card { background: linear-gradient(180deg, rgba(20,20,20,1) 0%, rgba(5,5,5,0) 100%); padding: 30px 20px 10px; text-align: center; }
        .main-header { font-size: 3rem; font-weight: 900; color: var(--primary); text-transform: uppercase; text-shadow: 0 0 15px var(--primary); cursor: pointer; user-select: none; letter-spacing: -1px; }
        .tagline { font-size: 0.8rem; color: #888; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 15px; }

        /* --- NAVIGATION --- */
        .cat-nav { display: flex; overflow-x: auto; padding: 10px 20px; gap: 10px; position: sticky; top: 0; z-index: 990; background: var(--bg-body); border-bottom: 1px solid #222; scrollbar-width: none; }
        .chip { padding: 8px 18px; background: #1a1a1a; border: 1px solid #333; border-radius: 50px; font-size: 13px; color: #aaa; white-space: nowrap; transition: 0.2s; font-weight: 600; }
        .chip.active { background: var(--primary); color: black; border-color: var(--primary); }

        /* --- FOOD LIST --- */
        .menu-container { padding-bottom: 50px; }
        .section-title { padding: 25px 20px 10px; font-size: 20px; font-weight: 800; color: white; text-transform: uppercase; border-left: 4px solid var(--primary); margin: 10px 0; display: flex; align-items: center; }
        
        .food-card { display: flex; background: var(--bg-card); border-radius: 16px; padding: 10px; gap: 15px; margin: 0 20px 15px; border: 1px solid #222; position: relative; overflow: hidden; }
        .food-card.out-of-stock { opacity: 0.5; filter: grayscale(1); border: 1px dashed #555; }
        
        .food-img { width: 95px; height: 95px; object-fit: cover; border-radius: 12px; background: #222; flex-shrink: 0; }
        
        .food-info { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .food-name { font-size: 16px; font-weight: 700; line-height: 1.2; margin-bottom: 4px; color: white; }
        .food-desc { font-size: 11px; color: #888; margin-bottom: 8px; line-height: 1.2; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;}
        .food-meta { display: flex; align-items: center; gap: 10px; }
        .price-tag { font-size: 16px; font-weight: 800; color: var(--primary); }
        .type-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
        
        .add-btn { background: #333; color: white; border: 1px solid #444; padding: 6px 20px; border-radius: 8px; font-weight: 700; font-size: 12px; position: absolute; right: 10px; bottom: 10px; cursor: pointer; transition: 0.2s; }
        .add-btn:active { background: var(--primary); color: black; border-color: var(--primary); transform: scale(0.95); }
        
        .qty-control { display: flex; align-items: center; background: #111; border: 1px solid var(--primary); border-radius: 8px; height: 32px; position: absolute; right: 10px; bottom: 10px; }
        .q-btn { width: 30px; height: 100%; background: transparent; border: none; color: var(--primary); font-size: 18px; font-weight: bold; cursor: pointer; }
        .q-val { color: white; font-weight: bold; font-size: 14px; min-width: 20px; text-align: center; }

        /* --- CART BAR --- */
        .cart-bar { position: fixed; bottom: 20px; left: 15px; right: 15px; background: var(--primary); color: black; padding: 15px 20px; border-radius: 12px; display: none; justify-content: space-between; align-items: center; z-index: 2000; font-weight: 900; box-shadow: 0 0 25px rgba(226, 255, 0, 0.4); cursor: pointer; animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popUp { from { transform: scale(0.8) translateY(20px); opacity: 0; } to { transform: scale(1) translateY(0); opacity: 1; } }

        /* --- OVERLAYS --- */
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); z-index: 3000; display: none; align-items: flex-end; }
        .sheet { background: #111; width: 100%; border-radius: 20px 20px 0 0; padding: 25px; max-height: 85vh; overflow-y: auto; border-top: 1px solid #333; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .form-input { width: 100%; padding: 15px; margin-bottom: 12px; background: #222; border: 1px solid #333; color: white; border-radius: 10px; font-size: 14px; outline: none; }
        .form-input:focus { border-color: var(--primary); }
        .btn-action { width: 100%; padding: 16px; background: var(--secondary); color: black; font-weight: 800; border: none; border-radius: 10px; font-size: 16px; margin-top: 10px; cursor: pointer; }

        /* --- ADMIN SPECIFIC --- */
        .admin-card { background: #1a1a1a; padding: 15px; margin-bottom: 15px; border-radius: 10px; border: 1px solid #333; }
        .admin-label { font-size: 10px; color: #888; text-transform: uppercase; margin-bottom: 4px; display: block; font-weight: bold; }
        .row { display: flex; gap: 10px; }
        .col { flex: 1; }
        .btn-save { background: var(--primary); width: 100%; padding: 12px; font-weight: bold; border: none; border-radius: 6px; cursor: pointer; margin-top: 8px; }
        .btn-toggle { background: #333; color: white; padding: 8px; border-radius: 6px; border: 1px solid #444; font-size: 12px; cursor: pointer; flex: 1; }
        .btn-toggle.active { background: var(--secondary); color: black; border-color: var(--secondary); }
        .btn-toggle.off { background: var(--danger); color: white; border-color: var(--danger); }

    </style>
</head>
<body>

    <div id="toast-box"></div>

    <div class="brand-card">
        <h1 class="main-header" onclick="handleSecretClick()">FLAVRZ</h1>
        <div class="tagline">Tap Logo 5 Times for Admin</div>
        <div style="display:flex; justify-content:center; gap:10px;">
            <button onclick="shareLink()" style="background:#222; color:white; border:1px solid #333; padding:8px 15px; border-radius:20px; font-size:12px;"><i class="ri-share-forward-fill"></i> Share Menu</button>
            <button onclick="clearData()" style="background:#222; color:#888; border:1px solid #333; padding:8px 15px; border-radius:20px; font-size:12px;">Reset Data</button>
        </div>
    </div>

    <div class="cat-nav" id="cat-nav"></div>

    <div class="menu-container" id="menu-list"></div>

    <div class="cart-bar" id="cart-bar" onclick="openCart()">
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="background: black; color:var(--primary); width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:900; font-size:14px;" id="cart-count">0</div>
            <div style="font-size: 15px;">VIEW CART</div>
        </div>
        <div style="font-size: 20px;">â‚¹<span id="cart-total">0</span></div>
    </div>

    <div class="overlay" id="cart-overlay" style="display: none;">
        <div class="sheet">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h2 style="color:var(--primary);">YOUR ORDER</h2>
                <i class="ri-close-circle-fill" style="font-size:28px; cursor:pointer;" onclick="document.getElementById('cart-overlay').style.display='none'"></i>
            </div>
            <div id="cart-items" style="margin-bottom:20px;"></div>
            
            <div style="background:#222; padding:15px; border-radius:10px; margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; color:#bbb; margin-bottom:5px;"><span>Item Total</span><span id="bill-subtotal">0</span></div>
                <div style="display:flex; justify-content:space-between; color:#bbb; margin-bottom:10px;"><span>Delivery</span><span id="bill-delivery">0</span></div>
                <div style="border-top:1px solid #444; padding-top:10px; display:flex; justify-content:space-between; font-size:18px; font-weight:bold; color:var(--primary);"><span>Total</span><span>â‚¹<span id="bill-total">0</span></span></div>
            </div>

            <input type="text" class="form-input" id="c-name" placeholder="Your Name">
            <input type="tel" class="form-input" id="c-phone" placeholder="WhatsApp Number">
            <input type="text" class="form-input" id="c-addr" placeholder="Flat No & Society Name">
            <textarea class="form-input" id="c-note" placeholder="Any cooking instructions?"></textarea>
            
            <button class="btn-action" onclick="sendOrder()">PLACE ORDER ON WHATSAPP</button>
        </div>
    </div>

    <div class="overlay" id="login-overlay" style="align-items: center; justify-content: center;">
        <div style="background:#222; padding:30px; border-radius:15px; border:1px solid var(--primary); width:80%; text-align:center;">
            <h2 style="color:var(--primary); margin-bottom:15px;">ADMIN PANEL</h2>
            <input type="password" id="pin-input" class="form-input" placeholder="Enter PIN" style="text-align:center; font-size:20px; letter-spacing:5px;">
            <button onclick="verifyPin()" style="width:100%; padding:12px; background:var(--primary); border:none; border-radius:8px; font-weight:bold;">LOGIN</button>
            <div onclick="document.getElementById('login-overlay').style.display='none'" style="margin-top:15px; color:#666; font-size:12px;">Cancel</div>
        </div>
    </div>

    <div class="overlay" id="admin-overlay">
        <div class="sheet">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h2 style="color:var(--primary);">MENU EDITOR</h2>
                <i class="ri-close-line" style="font-size:28px; cursor:pointer;" onclick="closeAdmin()"></i>
            </div>
            
            <div style="margin-bottom:15px;">
                <label class="admin-label">Select Category to Edit</label>
                <select id="admin-cat-select" class="form-input" onchange="loadAdminItems(this.value)">
                    <option value="" disabled selected>Choose Category...</option>
                </select>
            </div>

            <div id="admin-editor-area" style="padding-bottom:50px;"></div>
        </div>
    </div>

    <script>
        // --- 1. DATA CONFIGURATION ---
        const CONFIG = { pin: "212282", phone: "916230146463" }; // WhatsApp number format

        const DEFAULT_DATA = {
            "Momos": [
                { name: "Veg Momos", price: 60, desc: "Steamed vegetable dumplings", img: "https://github.com/jassykochhar/flavrzmenu/blob/main/veg-momos.jpg?raw=true", type: "veg", inStock: true },
                { name: "Paneer Momos", price: 80, desc: "Filled with fresh cottage cheese", img: "https://b.zmtcdn.com/data/dish_photos/08f/9590885093751702115668045608f.jpg", type: "veg", inStock: true },
                { name: "Chicken Momos", price: 90, desc: "Juicy chicken filling", img: "https://media.istockphoto.com/id/1155361862/photo/chicken-momos.jpg?s=612x612&w=0&k=20&c=K5xW4l-nKqf8q5i2q3o4p5.jpg", type: "non-veg", inStock: true }
            ],
            "Chinese": [
                { name: "Veg Fried Rice", price: 80, desc: "Wok tossed rice", img: "https://static.toiimg.com/thumb/53338316.cms?width=1200&height=900", type: "veg", inStock: true },
                { name: "Chilli Chicken", price: 120, desc: "Spicy gravy chicken", img: "https://www.indianhealthyrecipes.com/wp-content/uploads/2018/07/chilli-chicken-recipe-500x500.jpg", type: "non-veg", inStock: true }
            ],
            "Beverages": [
                { name: "Cold Coffee", price: 50, desc: "Chilled classic coffee", img: "https://www.cookwithmanali.com/wp-content/uploads/2022/06/Cold-Coffee.jpg", type: "veg", inStock: true }
            ]
        };

        // --- 2. STATE MANAGEMENT ---
        let menu = JSON.parse(localStorage.getItem('flavrz_menu_v2')) || DEFAULT_DATA;
        let cart = [];
        let tapCount = 0;

        // Force Save on First Load to fix old structure issues
        if(!localStorage.getItem('flavrz_menu_v2')) {
            localStorage.setItem('flavrz_menu_v2', JSON.stringify(menu));
        }

        // --- 3. CORE FUNCTIONS ---
        function init() {
            renderNav();
            renderMenu();
        }

        function renderNav() {
            const nav = document.getElementById('cat-nav');
            const select = document.getElementById('admin-cat-select');
            nav.innerHTML = "";
            select.innerHTML = '<option value="" disabled selected>Choose Category...</option>';

            Object.keys(menu).forEach(cat => {
                nav.innerHTML += `<button class="chip" onclick="scrollToCat('${cat}')">${cat}</button>`;
                select.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
        }

        function scrollToCat(cat) {
            document.getElementById(`head-${cat}`).scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function renderMenu() {
            const list = document.getElementById('menu-list');
            list.innerHTML = "";

            Object.entries(menu).forEach(([cat, items]) => {
                let html = `<div id="head-${cat}" class="section-title">${cat}</div>`;
                
                items.forEach((item, idx) => {
                    // Logic to find qty in cart
                    let qty = 0;
                    const cartItem = cart.find(c => c.name === item.name);
                    if (cartItem) qty = cartItem.qty;

                    // Fallback image if empty
                    const imgUrl = item.img && item.img.length > 5 ? item.img : "https://via.placeholder.com/100?text=No+Img";
                    const isVegColor = item.type === 'veg' ? '#00E676' : '#FF3B30';
                    const stockClass = item.inStock ? '' : 'out-of-stock';

                    html += `
                    <div class="food-card ${stockClass}">
                        <img src="${imgUrl}" class="food-img" onerror="this.src='https://via.placeholder.com/100?text=Error'">
                        <div class="food-info">
                            <div class="food-name">${item.name}</div>
                            <div class="food-desc">${item.desc}</div>
                            <div class="food-meta">
                                <span class="type-dot" style="background:${isVegColor}"></span>
                                <span class="price-tag">â‚¹${item.price}</span>
                            </div>
                        </div>
                        ${item.inStock ? 
                            (qty === 0 ? 
                            `<button class="add-btn" onclick="addToCart('${cat}', ${idx})">ADD</button>` : 
                            `<div class="qty-control">
                                <button class="q-btn" onclick="updateCart('${cat}', ${idx}, -1)">-</button>
                                <span class="q-val">${qty}</span>
                                <button class="q-btn" onclick="updateCart('${cat}', ${idx}, 1)">+</button>
                            </div>`) 
                        : `<div style="position:absolute; right:10px; bottom:10px; color:#ff3b30; font-weight:bold; font-size:12px; border:1px solid #ff3b30; padding:4px 8px; border-radius:4px;">SOLD OUT</div>`}
                    </div>`;
                });
                list.innerHTML += html;
            });
        }

        // --- 4. CART LOGIC ---
        function addToCart(cat, idx) { updateCart(cat, idx, 1); }

        function updateCart(cat, idx, change) {
            const item = menu[cat][idx];
            
            // Find in cart
            let existing = cart.find(c => c.name === item.name);

            if (existing) {
                existing.qty += change;
                if (existing.qty <= 0) {
                    cart = cart.filter(c => c.name !== item.name);
                    showToast("Item Removed");
                }
            } else if (change > 0) {
                cart.push({ ...item, qty: 1, cat: cat, idx: idx });
                showToast("Added to Cart");
            }

            renderMenu(); // Re-render to show +/- buttons
            updateCartBar();
        }

        function updateCartBar() {
            const bar = document.getElementById('cart-bar');
            const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const count = cart.reduce((sum, item) => sum + item.qty, 0);

            document.getElementById('cart-total').innerText = total;
            document.getElementById('cart-count').innerText = count;
            
            bar.style.display = count > 0 ? 'flex' : 'none';
        }

        function openCart() {
            const overlay = document.getElementById('cart-overlay');
            const container = document.getElementById('cart-items');
            container.innerHTML = "";

            let subtotal = 0;
            cart.forEach(item => {
                subtotal += item.price * item.qty;
                container.innerHTML += `
                <div style="display:flex; justify-content:space-between; margin-bottom:12px; border-bottom:1px solid #333; padding-bottom:10px;">
                    <div>
                        <div style="color:white; font-weight:700;">${item.name}</div>
                        <div style="color:var(--primary); font-size:13px;">â‚¹${item.price} x ${item.qty}</div>
                    </div>
                    <div style="color:white; font-weight:700;">â‚¹${item.price * item.qty}</div>
                </div>`;
            });

            // Delivery Logic
            const delivery = subtotal < 300 ? 40 : 0;
            const finalTotal = subtotal + delivery;

            document.getElementById('bill-subtotal').innerText = "â‚¹" + subtotal;
            document.getElementById('bill-delivery').innerText = delivery === 0 ? "FREE" : "â‚¹" + delivery;
            document.getElementById('bill-total').innerText = finalTotal;

            overlay.style.display = 'flex';
        }

        function sendOrder() {
            const name = document.getElementById('c-name').value;
            const addr = document.getElementById('c-addr').value;
            if(!name || !addr) return alert("Please enter Name and Address");

            let msg = `*NEW ORDER - FLAVRZ*%0A%0A`;
            msg += `ðŸ‘¤ *Name:* ${name}%0AðŸ  *Addr:* ${addr}%0A`;
            if(document.getElementById('c-note').value) msg += `ðŸ“ *Note:* ${document.getElementById('c-note').value}%0A`;
            
            msg += `%0A*ITEMS:*%0A`;
            cart.forEach(i => msg += `â–ªï¸ ${i.name} x ${i.qty}%0A`);
            
            msg += `%0A*TOTAL: ${document.getElementById('bill-total').innerText}*`;
            
            window.open(`https://wa.me/${CONFIG.phone}?text=${msg}`);
        }

        // --- 5. ADMIN LOGIC ---
        function handleSecretClick() {
            tapCount++;
            if(tapCount === 5) {
                tapCount = 0;
                document.getElementById('login-overlay').style.display = 'flex';
            }
        }

        function verifyPin() {
            if(document.getElementById('pin-input').value === CONFIG.pin) {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('admin-overlay').style.display = 'flex';
            } else {
                alert("Incorrect PIN");
            }
        }

        function loadAdminItems(cat) {
            const container = document.getElementById('admin-editor-area');
            container.innerHTML = "";
            const items = menu[cat];

            items.forEach((item, idx) => {
                container.innerHTML += `
                <div class="admin-card">
                    <div class="row">
                        <div class="col"><label class="admin-label">Name</label><input type="text" class="form-input" id="ed-name-${idx}" value="${item.name}"></div>
                        <div class="col" style="flex:0.4"><label class="admin-label">Price</label><input type="number" class="form-input" id="ed-price-${idx}" value="${item.price}"></div>
                    </div>
                    <label class="admin-label">Image Link (URL)</label>
                    <input type="text" class="form-input" id="ed-img-${idx}" value="${item.img}" placeholder="Paste https:// image link here">
                    
                    <div class="row" style="margin-top:5px;">
                        <button class="btn-toggle ${item.inStock ? 'active' : 'off'}" onclick="toggleStock('${cat}', ${idx})">
                            ${item.inStock ? 'IN STOCK' : 'OUT OF STOCK'}
                        </button>
                    </div>

                    <button class="btn-save" onclick="saveItem('${cat}', ${idx})">SAVE ITEM</button>
                </div>`;
            });
        }

        function saveItem(cat, idx) {
            // Get values
            const newName = document.getElementById(`ed-name-${idx}`).value;
            const newPrice = document.getElementById(`ed-price-${idx}`).value;
            const newImg = document.getElementById(`ed-img-${idx}`).value;

            // Update Object
            menu[cat][idx].name = newName;
            menu[cat][idx].price = parseInt(newPrice);
            menu[cat][idx].img = newImg;

            // Save to LocalStorage
            localStorage.setItem('flavrz_menu_v2', JSON.stringify(menu));
            
            showToast("Item Updated!");
            renderMenu(); // Update background view
        }

        function toggleStock(cat, idx) {
            menu[cat][idx].inStock = !menu[cat][idx].inStock;
            localStorage.setItem('flavrz_menu_v2', JSON.stringify(menu));
            loadAdminItems(cat); // Refresh admin view
            renderMenu(); // Refresh main view
        }

        function closeAdmin() {
            document.getElementById('admin-overlay').style.display = 'none';
        }

        // --- 6. UTILS ---
        function showToast(msg) {
            const t = document.getElementById('toast-box');
            t.innerText = msg;
            t.className = "show";
            setTimeout(() => t.className = "", 2500);
        }

        function shareLink() {
            navigator.clipboard.writeText(window.location.href);
            showToast("Link Copied");
        }

        function clearData() {
            if(confirm("This will reset all menu changes to default. Continue?")) {
                localStorage.clear();
                location.reload();
            }
        }

        // Start App
        init();

    </script>
</body>
</html>
